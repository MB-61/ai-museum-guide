<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - AI M√ºze Rehberi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .tab-btn.active {
            background: #3b82f6;
            color: white;
        }
    </style>
</head>

<body class="bg-slate-900 text-white min-h-screen">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-400">üèõÔ∏è Admin Panel</h1>
                <p class="text-slate-400 mt-2">AI M√ºze Rehberi Y√∂netim</p>
            </div>
            <form onsubmit="login(event)">
                <div class="mb-4">
                    <label class="block text-sm text-slate-400 mb-2">Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="username"
                        class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                        placeholder="admin">
                </div>
                <div class="mb-6">
                    <label class="block text-sm text-slate-400 mb-2">≈ûifre</label>
                    <input type="password" id="password"
                        class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition">
                    Giri≈ü Yap
                </button>
                <p id="login-error" class="text-red-400 text-sm mt-4 text-center hidden">Hatalƒ± kullanƒ±cƒ± adƒ± veya ≈üifre
                </p>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-screen" class="hidden">
        <!-- Header -->
        <header class="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="text-2xl">üèõÔ∏è</span>
                <h1 class="text-xl font-bold">Admin Panel</h1>
            </div>
            <button onclick="logout()" class="text-slate-400 hover:text-white flex items-center gap-2">
                <span class="material-symbols-outlined">logout</span>
                √áƒ±kƒ±≈ü
            </button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-slate-800 px-6 py-3 flex gap-2 overflow-x-auto">
            <button onclick="showTab('dashboard')"
                class="tab-btn active px-4 py-2 rounded-lg text-sm font-medium transition" data-tab="dashboard">üìä
                Dashboard</button>
            <button onclick="showTab('exhibits')"
                class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 hover:bg-slate-600 transition"
                data-tab="exhibits">üñºÔ∏è Eserler</button>
            <button onclick="showTab('greetings')"
                class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 hover:bg-slate-600 transition"
                data-tab="greetings">üí¨ Kar≈üƒ±lamalar</button>
            <button onclick="showTab('stats')"
                class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 hover:bg-slate-600 transition"
                data-tab="stats">üìà ƒ∞statistikler</button>
            <button onclick="showTab('api')"
                class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-700 hover:bg-slate-600 transition"
                data-tab="api">üîë API Anahtarlarƒ±</button>
        </nav>

        <!-- Content Area -->
        <main class="p-6">
            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">Dashboard</h2>
                    <div class="flex items-center gap-3">
                        <!-- Time Period Selector -->
                        <select id="time-period" onchange="loadDashboard()"
                            class="bg-slate-700 border-none rounded-lg px-3 py-2 text-sm focus:ring-blue-500">
                            <option value="today">Bug√ºn</option>
                            <option value="week">Bu Hafta</option>
                            <option value="month">Bu Ay</option>
                            <option value="year">Bu Yƒ±l</option>
                            <option value="all">T√ºm√º</option>
                        </select>
                        <label class="flex items-center gap-2 text-sm text-slate-400">
                            <input type="checkbox" id="auto-refresh" class="rounded">
                            <span>Oto yenile (<span id="countdown-timer">10</span>s)</span>
                        </label>
                        <button onclick="refreshAllData()"
                            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium transition flex items-center gap-2">
                            <span class="material-symbols-outlined" id="refresh-icon">refresh</span>
                            Yenile
                        </button>
                    </div>
                </div>

                <!-- Period Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="bg-slate-800 rounded-xl p-6">
                        <p id="stat-label-scans" class="text-slate-400 text-sm">Bug√ºn QR Tarama</p>
                        <p id="stat-scans" class="text-3xl font-bold text-blue-400 mt-2">-</p>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <p id="stat-label-chats" class="text-slate-400 text-sm">Bug√ºn Sohbet</p>
                        <p id="stat-chats" class="text-3xl font-bold text-green-400 mt-2">-</p>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <p id="stat-label-tokens" class="text-slate-400 text-sm">Bug√ºn Token</p>
                        <p id="stat-tokens" class="text-3xl font-bold text-purple-400 mt-2">-</p>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <p id="stat-label-cost" class="text-slate-400 text-sm">Bug√ºn Maliyet</p>
                        <p id="stat-cost" class="text-3xl font-bold text-yellow-400 mt-2">-</p>
                    </div>
                </div>
                <div class="bg-slate-800 rounded-xl p-6">
                    <h3 class="font-semibold mb-4">Toplam ƒ∞statistikler</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div>
                            <p class="text-slate-400 text-sm">Benzersiz IP</p>
                            <p id="stat-sessions" class="text-xl font-bold">-</p>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm">Toplam Token</p>
                            <p id="stat-total-tokens" class="text-xl font-bold">-</p>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm">API Anahtarƒ±</p>
                            <p id="stat-keys" class="text-xl font-bold">-</p>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm">Toplam Maliyet</p>
                            <p id="stat-total-cost" class="text-xl font-bold">-</p>
                        </div>
                    </div>
                </div>

                <!-- Pricing Info -->
                <div class="bg-slate-800/50 rounded-lg px-4 py-2 text-sm text-slate-400 flex items-center gap-4">
                    <span class="font-medium text-slate-300">üí∞ Gemini 2.5 Flash:</span>
                    <span>Input: $0.15/1M token</span>
                    <span>Output: $0.60/1M token</span>
                </div>

                <!-- Unique IPs -->
                <div class="bg-slate-800 rounded-xl p-6 mt-4">
                    <h3 class="font-semibold mb-3">üåê Benzersiz IP Adresleri</h3>
                    <div id="ip-list" class="flex flex-wrap gap-2 text-sm">
                        <span class="text-slate-400">Y√ºkleniyor...</span>
                    </div>
                </div>
            </div>

            <!-- Exhibits Tab -->
            <div id="tab-exhibits" class="tab-content hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold">RAG Eser Y√∂netimi</h2>
                        <p class="text-slate-400 text-sm mt-1">ted_museum klas√∂r√ºndeki eserler (<span
                                id="exhibit-count">0</span> adet)</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="printAllQRCodes()"
                            class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2">
                            <span class="material-symbols-outlined">print</span>
                            T√ºm QR Yazdƒ±r
                        </button>
                        <button onclick="runRAGIngestion()" id="ingest-btn"
                            class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2">
                            <span class="material-symbols-outlined">sync</span>
                            RAG G√ºncelle
                        </button>
                        <button onclick="showCreateExhibitModal()"
                            class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2">
                            <span class="material-symbols-outlined">add</span>
                            Yeni Eser
                        </button>
                    </div>
                </div>

                <!-- Search -->
                <div class="flex items-center gap-4 mb-4">
                    <input type="text" id="exhibit-search" onkeyup="filterExhibits()" placeholder="Eser ara..."
                        class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500">
                    <label
                        class="flex items-center gap-2 cursor-pointer bg-slate-700 px-4 py-3 rounded-lg hover:bg-slate-600 transition">
                        <input type="checkbox" id="show-images-toggle" onchange="toggleImageView()"
                            class="w-4 h-4 rounded">
                        <span class="text-sm text-slate-300">Resimli G√∂r√ºn√ºm</span>
                    </label>
                </div>

                <!-- Card View (hidden by default) -->
                <div id="exhibit-cards" class="hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4"></div>

                <div id="exhibit-table-container" class="bg-slate-800 rounded-xl overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-slate-700">
                            <tr>
                                <th class="text-left px-4 py-3 text-sm font-medium text-slate-300">ID</th>
                                <th class="text-left px-4 py-3 text-sm font-medium text-slate-300">Ba≈ülƒ±k</th>
                                <th class="text-left px-4 py-3 text-sm font-medium text-slate-300">QR</th>
                                <th class="text-left px-4 py-3 text-sm font-medium text-slate-300">Boyut</th>
                                <th class="text-right px-4 py-3 text-sm font-medium text-slate-300">ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="rag-exhibits-list" class="divide-y divide-slate-700"></tbody>
                    </table>
                </div>
            </div>

            <!-- Exhibit Editor Modal -->
            <div id="exhibit-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4">
                <div class="bg-slate-800 rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                    <div class="flex items-center justify-between p-4 border-b border-slate-700">
                        <h3 id="modal-title" class="text-xl font-bold">Eser D√ºzenle</h3>
                        <button onclick="closeExhibitModal()" class="text-slate-400 hover:text-white">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <div class="p-4 flex-1 overflow-y-auto">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm text-slate-400 mb-2">ID</label>
                                <input type="text" id="modal-exhibit-id" disabled
                                    class="w-full bg-slate-600 border border-slate-500 rounded-lg px-4 py-2 text-slate-300">
                            </div>
                            <div>
                                <label class="block text-sm text-slate-400 mb-2">QR Kodu</label>
                                <div class="flex gap-2">
                                    <input type="text" id="modal-qr-id" placeholder="qr_01" onblur="checkQRDuplicate()"
                                        class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500">
                                    <button id="modal-qr-oto-btn" onclick="autoFillQR()" type="button"
                                        class="px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-medium"
                                        title="Sonraki QR">
                                        Oto
                                    </button>
                                </div>
                                <span id="qr-duplicate-warning" class="text-red-400 text-xs mt-1 hidden">‚ö†Ô∏è Bu QR kodu
                                    zaten kullanƒ±lƒ±yor!</span>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm text-slate-400 mb-2">Ba≈ülƒ±k (ilk satƒ±r olarak eklenir)</label>
                            <input type="text" id="modal-title-input" placeholder="Eser ba≈ülƒ±ƒüƒ±..."
                                class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500">
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm text-slate-400 mb-2">Kategori</label>
                                <select id="modal-category"
                                    class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500">
                                    <option value="">Se√ßiniz...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-slate-400 mb-2">Resim (s√ºr√ºkle-bƒ±rak veya
                                    Ctrl+V)</label>
                                <div id="image-drop-zone"
                                    class="w-full h-32 bg-slate-700 border-2 border-dashed border-slate-500 rounded-lg flex items-center justify-center cursor-pointer hover:border-blue-500 transition relative overflow-hidden">
                                    <div id="image-placeholder" class="text-center">
                                        <span
                                            class="material-symbols-outlined text-4xl text-slate-500">cloud_upload</span>
                                        <p class="text-slate-500 text-sm mt-1">Resmi s√ºr√ºkle veya tƒ±kla</p>
                                    </div>
                                    <img id="image-preview" class="absolute inset-0 w-full h-full object-cover hidden">
                                    <input type="file" id="image-file-input" accept="image/*" class="hidden">
                                    <input type="hidden" id="modal-image">
                                </div>
                                <button type="button" onclick="clearImagePreview()"
                                    class="mt-1 text-xs text-red-400 hover:text-red-300">Resmi Kaldƒ±r</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">ƒ∞√ßerik</label>
                            <textarea id="modal-content" rows="18"
                                class="w-full bg-slate-700 border border-slate-600 rounded-lg p-4 text-sm focus:outline-none focus:border-blue-500 font-mono"
                                placeholder="Eser i√ßeriƒüini yazƒ±n..."></textarea>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-4 border-t border-slate-700">
                        <div class="flex items-center gap-4">
                            <button id="modal-delete-btn" onclick="deleteFromModal()"
                                class="hidden px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition flex items-center gap-2">
                                <span class="material-symbols-outlined" style="font-size:18px">delete</span>
                                Eseri Sil
                            </button>
                            <p class="text-slate-400 text-sm">‚ö†Ô∏è Kayƒ±t sonrasƒ± RAG gerekir</p>
                        </div>
                        <div class="flex gap-2">
                            <button id="modal-cancel-btn" onclick="closeExhibitModal()"
                                class="px-6 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition">ƒ∞ptal</button>
                            <button id="modal-save-btn" onclick="saveExhibitModal()"
                                class="px-6 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 font-medium transition">Kaydet</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QR Code Modal -->
            <div id="qr-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4">
                <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full text-center">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">QR Kodu</h3>
                        <button onclick="closeQRModal()" class="text-slate-400 hover:text-white">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <p id="qr-modal-title" class="text-slate-400 text-sm mb-4"></p>
                    <div id="qr-code-container" class="bg-white p-4 rounded-xl inline-block mb-4"></div>
                    <p id="qr-modal-id" class="text-blue-400 font-mono text-lg mb-4"></p>
                    <div class="flex gap-2 justify-center">
                        <button onclick="downloadQRCode()"
                            class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition flex items-center gap-2">
                            <span class="material-symbols-outlined">download</span>
                            PNG ƒ∞ndir
                        </button>
                        <button onclick="closeQRModal()"
                            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition">
                            Kapat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Greetings Tab -->
            <div id="tab-greetings" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-6">Kar≈üƒ±lama C√ºmleleri</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-slate-800 rounded-xl p-6">
                        <h3 class="font-semibold mb-4">üéØ QR Modlu Kar≈üƒ±lamalar</h3>
                        <p class="text-slate-400 text-sm mb-3">Her satƒ±r bir kar≈üƒ±lama. {exhibit} yerine eser adƒ± gelir.
                        </p>
                        <textarea id="qr-greetings"
                            class="w-full h-64 bg-slate-700 border border-slate-600 rounded-lg p-4 text-sm focus:outline-none focus:border-blue-500"
                            placeholder="Y√ºkleniyor..."></textarea>
                        <button onclick="saveQrGreetings()"
                            class="mt-4 bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-medium transition">Kaydet</button>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <h3 class="font-semibold mb-4">üåê Genel Mod Kar≈üƒ±lamalar</h3>
                        <p class="text-slate-400 text-sm mb-3">QR olmadan giri≈üte kullanƒ±lƒ±r.</p>
                        <textarea id="general-greetings"
                            class="w-full h-64 bg-slate-700 border border-slate-600 rounded-lg p-4 text-sm focus:outline-none focus:border-blue-500"
                            placeholder="Y√ºkleniyor..."></textarea>
                        <button onclick="saveGeneralGreetings()"
                            class="mt-4 bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-medium transition">Kaydet</button>
                    </div>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="tab-stats" class="tab-content hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">ƒ∞statistikler</h2>
                    <button onclick="loadStats()"
                        class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined">refresh</span>
                        Yenile
                    </button>
                </div>

                <!-- QR Stats and Recent Questions -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-slate-800 rounded-xl p-6">
                        <h3 class="font-semibold mb-4">üî• En √áok Taranan QR Kodlar <span
                                class="text-slate-400 text-sm font-normal">(ƒ∞lk 10)</span></h3>
                        <div id="top-qr" class="space-y-2 max-h-80 overflow-y-auto"></div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <h3 class="font-semibold mb-4">üí¨ Son Sorular</h3>
                        <div id="recent-questions" class="space-y-2 max-h-80 overflow-y-auto"></div>
                    </div>
                </div>

                <!-- Token Usage Section -->
                <div class="bg-slate-800 rounded-xl p-6">
                    <h3 class="font-semibold mb-4">üìä Token Kullanƒ±mƒ±</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                            <p class="text-slate-400 text-sm">Toplam Input</p>
                            <p id="token-input" class="text-xl font-bold text-blue-400 mt-1">-</p>
                        </div>
                        <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                            <p class="text-slate-400 text-sm">Toplam Output</p>
                            <p id="token-output" class="text-xl font-bold text-green-400 mt-1">-</p>
                        </div>
                        <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                            <p class="text-slate-400 text-sm">Toplam ƒ∞stek</p>
                            <p id="token-requests" class="text-xl font-bold text-purple-400 mt-1">-</p>
                        </div>
                        <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                            <p class="text-slate-400 text-sm">Toplam Maliyet</p>
                            <p id="token-cost" class="text-xl font-bold text-yellow-400 mt-1">-</p>
                        </div>
                    </div>
                    <h4 class="text-sm text-slate-400 mb-2">Ge√ßmi≈ü Kullanƒ±m</h4>
                    <div id="token-daily" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>
            </div>

            <!-- API Tab -->
            <div id="tab-api" class="tab-content hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">API Anahtarlarƒ±</h2>
                    <button onclick="loadApiKeys()"
                        class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium transition flex items-center gap-2">
                        <span class="material-symbols-outlined">refresh</span>
                        Yenile
                    </button>
                </div>

                <!-- API Keys Status -->
                <div class="bg-slate-800 rounded-xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold">üîë Gemini API Anahtarlarƒ±</h3>
                        <div class="flex items-center gap-4 text-sm">
                            <span id="current-key" class="text-slate-400">Aktif: -</span>
                            <span id="api-timeout" class="text-slate-400">Timeout: -s</span>
                        </div>
                    </div>
                    <div id="api-keys-list" class="space-y-2"></div>
                </div>

                <!-- API Error Logs -->
                <div class="bg-slate-800 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold">‚ö†Ô∏è API Hata Loglarƒ±</h3>
                        <button onclick="loadApiErrors()"
                            class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition">
                            Yenile
                        </button>
                    </div>
                    <div id="api-errors-list" class="space-y-2 max-h-80 overflow-y-auto">
                        <p class="text-slate-400 text-sm">Hen√ºz hata yok</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center">
        <div class="bg-slate-800 rounded-2xl p-8 text-center max-w-sm">
            <div class="animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4">
            </div>
            <h3 class="text-xl font-bold mb-2">RAG G√ºncelleniyor</h3>
            <p class="text-slate-400">L√ºtfen bekleyin, bu i≈ülem birka√ß dakika s√ºrebilir...</p>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full text-center">
            <div class="w-14 h-14 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-blue-400 text-3xl">help</span>
            </div>
            <h3 id="confirm-title" class="text-xl font-bold mb-2">Onay</h3>
            <p id="confirm-message" class="text-slate-400 mb-6"></p>
            <div class="flex gap-3 justify-center">
                <button id="confirm-cancel"
                    class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium transition">ƒ∞ptal</button>
                <button id="confirm-ok"
                    class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition">Tamam</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full text-center">
            <div id="alert-icon-container" class="w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-4">
                <span id="alert-icon" class="material-symbols-outlined text-3xl"></span>
            </div>
            <h3 id="alert-title" class="text-xl font-bold mb-2">Bilgi</h3>
            <p id="alert-message" class="text-slate-400 mb-6"></p>
            <button id="alert-ok"
                class="px-8 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition">Tamam</button>
        </div>
    </div>

    <script>
        const API_BASE = '/api/v1/admin';
        let authToken = localStorage.getItem('adminToken');

        // Check if already logged in
        if (authToken) {
            fetchDashboard().then(ok => {
                if (ok) showAdminScreen();
            });
        }

        // Custom Confirm Dialog
        function customConfirm(message, title = 'Onay') {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirm-modal');
                document.getElementById('confirm-title').textContent = title;
                document.getElementById('confirm-message').textContent = message;
                modal.classList.remove('hidden');
                modal.classList.add('flex');

                const okBtn = document.getElementById('confirm-ok');
                const cancelBtn = document.getElementById('confirm-cancel');

                const cleanup = () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    okBtn.onclick = null;
                    cancelBtn.onclick = null;
                };

                okBtn.onclick = () => { cleanup(); resolve(true); };
                cancelBtn.onclick = () => { cleanup(); resolve(false); };
            });
        }

        // Custom Alert Dialog
        function customAlert(message, type = 'info') {
            return new Promise((resolve) => {
                const modal = document.getElementById('alert-modal');
                const iconContainer = document.getElementById('alert-icon-container');
                const icon = document.getElementById('alert-icon');
                const title = document.getElementById('alert-title');

                // Set icon and colors based on type
                if (type === 'success') {
                    iconContainer.className = 'w-14 h-14 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4';
                    icon.className = 'material-symbols-outlined text-green-400 text-3xl';
                    icon.textContent = 'check_circle';
                    title.textContent = 'Ba≈üarƒ±lƒ±';
                } else if (type === 'error') {
                    iconContainer.className = 'w-14 h-14 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4';
                    icon.className = 'material-symbols-outlined text-red-400 text-3xl';
                    icon.textContent = 'error';
                    title.textContent = 'Hata';
                } else {
                    iconContainer.className = 'w-14 h-14 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4';
                    icon.className = 'material-symbols-outlined text-blue-400 text-3xl';
                    icon.textContent = 'info';
                    title.textContent = 'Bilgi';
                }

                document.getElementById('alert-message').textContent = message;
                modal.classList.remove('hidden');
                modal.classList.add('flex');

                document.getElementById('alert-ok').onclick = () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    resolve();
                };
            });
        }

        async function login(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const res = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (res.ok) {
                    const data = await res.json();
                    authToken = data.token;
                    localStorage.setItem('adminToken', authToken);
                    showAdminScreen();
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            } catch (err) {
                console.error(err);
            }
        }

        function logout() {
            localStorage.removeItem('adminToken');
            authToken = null;
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('admin-screen').classList.add('hidden');
        }

        function showAdminScreen() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('admin-screen').classList.remove('hidden');
            loadDashboard();
            loadGreetings();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active', 'bg-blue-500');
                b.classList.add('bg-slate-700');
            });

            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('bg-slate-700');

            if (tabName === 'dashboard') loadDashboard();
            if (tabName === 'tokens') loadTokens();
            if (tabName === 'stats') loadStats();
            if (tabName === 'api') loadApiKeys();
        }

        async function fetchWithAuth(url) {
            const res = await fetch(url, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });
            if (res.status === 401) {
                logout();
                return null;
            }
            return res.json();
        }

        async function fetchDashboard() {
            try {
                const data = await fetchWithAuth(`${API_BASE}/dashboard`);
                return data !== null;
            } catch {
                return false;
            }
        }

        async function loadDashboard() {
            const period = document.getElementById('time-period')?.value || 'today';

            // Update labels based on period
            const periodLabels = {
                'today': 'Bug√ºn',
                'week': 'Haftalƒ±k',
                'month': 'Aylƒ±k',
                'year': 'Yƒ±llƒ±k',
                'all': 'Toplam'
            };
            const label = periodLabels[period] || 'Bug√ºn';

            document.getElementById('stat-label-scans').textContent = `${label} QR Tarama`;
            document.getElementById('stat-label-chats').textContent = `${label} Sohbet`;
            document.getElementById('stat-label-tokens').textContent = `${label} Token`;
            document.getElementById('stat-label-cost').textContent = `${label} Maliyet`;

            const data = await fetchWithAuth(`${API_BASE}/dashboard?period=${period}`);
            if (!data) return;
            document.getElementById('stat-scans').textContent = data.today_scans || 0;
            document.getElementById('stat-chats').textContent = data.today_chats || 0;
            document.getElementById('stat-tokens').textContent = (data.today_tokens || 0).toLocaleString();
            document.getElementById('stat-cost').textContent = `$${data.today_cost || 0}`;
            document.getElementById('stat-sessions').textContent = data.unique_visitors || data.total_sessions || 0;
            document.getElementById('stat-total-tokens').textContent = (data.total_tokens || 0).toLocaleString();
            document.getElementById('stat-keys').textContent = data.api_keys_count || 0;
            document.getElementById('stat-total-cost').textContent = `$${data.total_cost || 0}`;

            // Load IPs from stats
            const stats = await fetchWithAuth(`${API_BASE}/stats`);
            if (stats && stats.unique_ips) {
                const ipList = document.getElementById('ip-list');
                if (stats.unique_ips.length > 0) {
                    ipList.innerHTML = stats.unique_ips.map(ip =>
                        `<span class="bg-slate-700 px-2 py-1 rounded font-mono">${ip}</span>`
                    ).join('');
                } else {
                    ipList.innerHTML = '<span class="text-slate-500">Hen√ºz IP kaydƒ± yok</span>';
                }
            }
        }

        async function refreshAllData() {
            const icon = document.getElementById('refresh-icon');
            icon.classList.add('animate-spin');

            await loadDashboard();

            setTimeout(() => icon.classList.remove('animate-spin'), 500);
        }

        // Countdown timer for auto-refresh
        let countdownValue = 10;

        setInterval(() => {
            // Stop if not logged in or admin screen hidden
            if (!authToken || document.getElementById('admin-screen').classList.contains('hidden')) {
                return;
            }

            const autoRefresh = document.getElementById('auto-refresh');
            const countdownEl = document.getElementById('countdown-timer');

            if (autoRefresh && autoRefresh.checked) {
                const currentTab = document.querySelector('.tab-btn.active');
                if (currentTab && currentTab.dataset.tab === 'dashboard') {
                    countdownValue--;
                    if (countdownEl) countdownEl.textContent = countdownValue;

                    if (countdownValue <= 0) {
                        loadDashboard();
                        countdownValue = 10;
                        if (countdownEl) countdownEl.textContent = countdownValue;
                    }
                } else {
                    countdownValue = 10;
                    if (countdownEl) countdownEl.textContent = countdownValue;
                }
            } else {
                countdownValue = 10;
                if (countdownEl) countdownEl.textContent = countdownValue;
            }
        }, 1000);

        async function loadGreetings() {
            const qr = await fetchWithAuth(`${API_BASE}/greetings/qr`);
            const general = await fetchWithAuth(`${API_BASE}/greetings/general`);

            if (qr) document.getElementById('qr-greetings').value = qr.content || '';
            if (general) document.getElementById('general-greetings').value = general.content || '';
        }

        async function saveQrGreetings() {
            const content = document.getElementById('qr-greetings').value;
            await fetch(`${API_BASE}/greetings/qr`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ content })
            });
            alert('Kaydedildi!');
        }

        async function saveGeneralGreetings() {
            const content = document.getElementById('general-greetings').value;
            await fetch(`${API_BASE}/greetings/general`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ content })
            });
            alert('Kaydedildi!');
        }

        async function loadTokens() {
            const data = await fetchWithAuth(`${API_BASE}/tokens`);
            if (!data) return;

            document.getElementById('token-input').textContent = (data.total?.input || 0).toLocaleString();
            document.getElementById('token-output').textContent = (data.total?.output || 0).toLocaleString();
            document.getElementById('token-requests').textContent = (data.total?.requests || 0).toLocaleString();

            const daily = document.getElementById('token-daily');
            daily.innerHTML = '';
            for (const [date, stats] of Object.entries(data.daily_history || {})) {
                daily.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-700 rounded-lg px-4 py-2">
                        <span>${date}</span>
                        <span class="text-slate-400">Input: ${stats.input.toLocaleString()} | Output: ${stats.output.toLocaleString()}</span>
                    </div>
                `;
            }
        }

        async function loadStats() {
            const data = await fetchWithAuth(`${API_BASE}/stats`);
            const tokens = await fetchWithAuth(`${API_BASE}/tokens`);
            if (!data) return;

            // Top 10 QR codes
            const topQr = document.getElementById('top-qr');
            topQr.innerHTML = '';
            (data.top_qr_codes || []).slice(0, 10).forEach((q, i) => {
                topQr.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-700 rounded-lg px-4 py-2">
                        <span>${i + 1}. ${q.name || q.qr_id}</span>
                        <span class="text-blue-400 font-bold">${q.count}</span>
                    </div>
                `;
            });

            // Recent questions
            const questions = document.getElementById('recent-questions');
            questions.innerHTML = '';
            (data.recent_questions || []).forEach(q => {
                questions.innerHTML += `
                    <div class="bg-slate-700 rounded-lg px-4 py-2 text-sm">
                        <p class="text-white">${q.text}</p>
                        <p class="text-slate-500 text-xs mt-1">${new Date(q.time).toLocaleString('tr-TR')}</p>
                    </div>
                `;
            });

            // Token stats
            if (tokens) {
                document.getElementById('token-input').textContent = (tokens.total?.input || 0).toLocaleString();
                document.getElementById('token-output').textContent = (tokens.total?.output || 0).toLocaleString();
                document.getElementById('token-requests').textContent = (tokens.total?.requests || 0).toLocaleString();
                document.getElementById('token-cost').textContent = `$${(tokens.estimated_cost_usd || 0).toFixed(4)}`;

                // Daily history - show date and total tokens for that day
                const daily = document.getElementById('token-daily');
                daily.innerHTML = '';
                const dailyEntries = Object.entries(tokens.daily_history || {}).sort((a, b) => b[0].localeCompare(a[0]));
                dailyEntries.forEach(([date, stats]) => {
                    const totalDay = (stats.input || 0) + (stats.output || 0);
                    daily.innerHTML += `
                        <div class="flex justify-between items-center bg-slate-700/50 rounded-lg px-4 py-2 text-sm">
                            <span class="text-slate-300">${date}</span>
                            <span class="text-purple-400 font-medium">${totalDay.toLocaleString()} token</span>
                        </div>
                    `;
                });
            }
        }

        async function loadApiKeys() {
            const data = await fetchWithAuth(`${API_BASE}/api-keys`);
            if (!data) return;

            document.getElementById('current-key').textContent = `Aktif: #${data.current_index + 1}`;
            document.getElementById('api-timeout').textContent = `Timeout: ${data.timeout || 15}s`;

            const list = document.getElementById('api-keys-list');
            list.innerHTML = '';
            (data.keys || []).forEach((k, i) => {
                const isActive = k.status === 'active';
                const statusColor = isActive ? 'text-green-400' : 'text-slate-400';
                const statusBg = isActive ? 'bg-green-500/20' : 'bg-slate-600';
                list.innerHTML += `
                    <div class="flex justify-between items-center ${isActive ? 'bg-green-900/20 border border-green-500/30' : 'bg-slate-700'} rounded-lg px-4 py-3">
                        <div class="flex items-center gap-3">
                            <span class="w-8 h-8 ${statusBg} rounded-full flex items-center justify-center text-sm font-bold">#${k.index || i + 1}</span>
                            <span class="font-mono text-sm">${k.key || 'N/A'}</span>
                        </div>
                        <span class="${statusColor} font-medium text-sm px-3 py-1 rounded-full ${statusBg}">${k.status || 'standby'}</span>
                    </div>
                `;
            });

            // Also load errors when loading keys
            loadApiErrors();
        }

        async function loadApiErrors() {
            const data = await fetchWithAuth(`${API_BASE}/api-errors`);
            const list = document.getElementById('api-errors-list');
            list.innerHTML = '';

            if (!data || !data.errors || data.errors.length === 0) {
                list.innerHTML = '<p class="text-slate-400 text-sm">‚úÖ Hen√ºz hata yok</p>';
                return;
            }

            data.errors.slice().reverse().forEach(error => {
                // Parse error log line: [timestamp] CATEGORY: xxx | KEY: xxx | ACTION: xxx | ERROR: xxx
                const categoryMatch = error.match(/CATEGORY: (\w+)/);
                const keyMatch = error.match(/KEY: ([\d\/]+)/);
                const actionMatch = error.match(/ACTION: (\w+)/);
                const errorMatch = error.match(/ERROR: (.+)$/);
                const timeMatch = error.match(/\[([\d\-: ]+)\]/);

                const category = categoryMatch ? categoryMatch[1] : 'UNKNOWN';
                const keyInfo = keyMatch ? keyMatch[1] : '?';
                const action = actionMatch ? actionMatch[1] : '?';
                const errorMsg = errorMatch ? errorMatch[1] : error;
                const time = timeMatch ? timeMatch[1] : '';

                // Category colors
                const categoryColors = {
                    'RATE_LIMIT': 'bg-yellow-500/20 text-yellow-400',
                    'LEAKED': 'bg-red-500/20 text-red-400',
                    'INVALID': 'bg-red-500/20 text-red-400',
                    'TIMEOUT': 'bg-orange-500/20 text-orange-400',
                    'QUOTA': 'bg-yellow-500/20 text-yellow-400',
                    'PERMISSION': 'bg-red-500/20 text-red-400',
                    'ALL_KEYS_EXHAUSTED': 'bg-red-500/20 text-red-400',
                    'UNKNOWN': 'bg-slate-500/20 text-slate-400'
                };
                const colorClass = categoryColors[category] || categoryColors['UNKNOWN'];

                list.innerHTML += `
                    <div class="bg-slate-700/50 rounded-lg px-4 py-3 text-sm border-l-4 ${category.includes('LEAKED') || category.includes('EXHAUSTED') ? 'border-red-500' : 'border-yellow-500'}">
                        <div class="flex items-center justify-between mb-2">
                            <span class="px-2 py-0.5 rounded text-xs font-medium ${colorClass}">${category}</span>
                            <span class="text-slate-500 text-xs">${time}</span>
                        </div>
                        <div class="flex items-center gap-4 text-xs text-slate-400 mb-2">
                            <span>üîë Key: ${keyInfo}</span>
                            <span>‚ö° ${action}</span>
                        </div>
                        <p class="text-slate-300 text-xs break-all">${errorMsg.substring(0, 150)}${errorMsg.length > 150 ? '...' : ''}</p>
                    </div>
                `;
            });
        }

        // ========== RAG EXHIBITS ==========
        let allExhibits = [];
        let currentEditExhibitId = null;
        let isCreatingNew = false;

        async function loadExhibits() {
            const data = await fetchWithAuth(`${API_BASE}/rag-exhibits`);
            if (!data) return;

            allExhibits = data.exhibits || [];
            // Store next available ID
            window.nextExhibitId = data.next_id || 'ID_01';

            // Sort by ID number
            allExhibits.sort((a, b) => {
                const numA = parseInt(a.exhibit_id.replace('ID_', '')) || 999;
                const numB = parseInt(b.exhibit_id.replace('ID_', '')) || 999;
                return numA - numB;
            });
            document.getElementById('exhibit-count').textContent = data.total || 0;
            renderExhibitsTable(allExhibits);

            // Also refresh card view if visible
            if (document.getElementById('show-images-toggle').checked) {
                renderExhibitCards(allExhibits);
            }
        }

        function renderExhibitsTable(exhibits) {
            const tbody = document.getElementById('rag-exhibits-list');
            tbody.innerHTML = '';

            exhibits.forEach(e => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-700/50';
                tr.innerHTML = `
                    <td class="px-4 py-3 text-slate-400 text-sm font-mono">${e.exhibit_id}</td>
                    <td class="px-4 py-3 font-medium">${e.title.substring(0, 50)}${e.title.length > 50 ? '...' : ''}</td>
                    <td class="px-4 py-3">
                        ${e.qr ? `<span class="bg-blue-600/30 text-blue-300 px-2 py-1 rounded text-xs font-mono">${e.qr}</span>` : '<span class="text-slate-500">-</span>'}
                    </td>
                    <td class="px-4 py-3 text-slate-400 text-sm">${(e.size / 1000).toFixed(1)} KB</td>
                    <td class="px-4 py-3 text-right flex gap-1 justify-end">
                        ${e.qr ? `<button onclick="showQRCode('${e.qr}')" class="text-purple-400 hover:text-purple-300" title="QR Kodu G√∂ster">
                            <span class="material-symbols-outlined" style="font-size:20px">qr_code_2</span>
                        </button>` : ''}
                        <button onclick="openExhibitEditor('${e.exhibit_id}')" class="text-blue-400 hover:text-blue-300" title="D√ºzenle">
                            <span class="material-symbols-outlined" style="font-size:20px">edit</span>
                        </button>
                        <button onclick="deleteRAGExhibit('${e.exhibit_id}')" class="text-red-400 hover:text-red-300" title="Sil">
                            <span class="material-symbols-outlined" style="font-size:20px">delete</span>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterExhibits() {
            const search = document.getElementById('exhibit-search').value.toLowerCase();
            const filtered = allExhibits.filter(e =>
                e.title.toLowerCase().includes(search) ||
                e.exhibit_id.toLowerCase().includes(search) ||
                (e.qr && e.qr.toLowerCase().includes(search))
            );
            renderExhibitsTable(filtered);
            if (document.getElementById('show-images-toggle').checked) {
                renderExhibitCards(filtered);
            }
        }

        let exhibitMetadataCache = null;

        async function loadExhibitMetadata() {
            if (exhibitMetadataCache) return exhibitMetadataCache;
            try {
                const data = await fetchWithAuth(`${API_BASE}/exhibit-metadata`);
                exhibitMetadataCache = data?.exhibits || {};
                return exhibitMetadataCache;
            } catch {
                return {};
            }
        }

        async function toggleImageView() {
            const isCard = document.getElementById('show-images-toggle').checked;
            const tableContainer = document.getElementById('exhibit-table-container');
            const cards = document.getElementById('exhibit-cards');

            if (isCard) {
                tableContainer.classList.add('hidden');
                cards.classList.remove('hidden');
                // Clear cache to get fresh data
                exhibitMetadataCache = null;
                await loadExhibitMetadata();
                const search = document.getElementById('exhibit-search').value.toLowerCase();
                const filtered = allExhibits.filter(e =>
                    e.title.toLowerCase().includes(search) ||
                    e.exhibit_id.toLowerCase().includes(search) ||
                    (e.qr_id && e.qr_id.toLowerCase().includes(search))
                );
                renderExhibitCards(filtered);
            } else {
                tableContainer.classList.remove('hidden');
                cards.classList.add('hidden');
            }
        }

        async function renderExhibitCards(exhibits) {
            const container = document.getElementById('exhibit-cards');
            container.innerHTML = '';

            exhibits.forEach(e => {
                // Use fields directly from API response
                const hasImage = e.image && e.image.trim() !== '';
                const imageUrl = e.image || '';
                const category = e.category || '';

                const card = document.createElement('div');
                card.className = 'bg-slate-800 rounded-xl overflow-hidden hover:ring-2 hover:ring-blue-500 transition cursor-pointer';
                card.onclick = () => openExhibitEditor(e.exhibit_id);

                // Image or placeholder
                const imageContent = hasImage
                    ? `<img src="${imageUrl}" alt="${e.title}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\\'flex items-center justify-center h-full\\'><span class=\\'material-symbols-outlined text-5xl text-slate-500\\'>help</span></div>'">`
                    : `<div class="flex items-center justify-center h-full">
                        <span class="material-symbols-outlined text-5xl text-slate-500">help</span>
                       </div>`;

                card.innerHTML = `
                    <div class="aspect-video bg-slate-700 relative overflow-hidden">
                        ${imageContent}
                        ${e.qr ? `<span class="absolute top-2 left-2 bg-blue-600/90 text-xs px-2 py-1 rounded font-mono">${e.qr}</span>` : ''}
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm line-clamp-2 mb-1">${e.title}</h4>
                        ${category ? `<span class="text-xs text-slate-400">${category}</span>` : ''}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function getNextQRNumber() {
            const usedNumbers = allExhibits
                .filter(e => e.qr && e.qr.startsWith('qr_'))
                .map(e => parseInt(e.qr.replace('qr_', '')) || 0);
            const maxNum = usedNumbers.length > 0 ? Math.max(...usedNumbers) : 0;
            return maxNum + 1;
        }

        function autoFillQR() {
            const nextNum = getNextQRNumber();
            document.getElementById('modal-qr-id').value = `qr_${String(nextNum).padStart(2, '0')}`;
            checkQRDuplicate();
        }

        function checkQRDuplicate() {
            const qrInput = document.getElementById('modal-qr-id');
            const warning = document.getElementById('qr-duplicate-warning');
            const qrId = qrInput.value.trim();

            if (!qrId) {
                warning.classList.add('hidden');
                return false;
            }

            // Check if QR is already used (by another exhibit, not the current one being edited)
            const isDuplicate = allExhibits.some(e =>
                e.qr === qrId &&
                e.exhibit_id !== currentEditExhibitId
            );

            if (isDuplicate) {
                warning.classList.remove('hidden');
                qrInput.classList.add('border-red-500');
                return true;
            } else {
                warning.classList.add('hidden');
                qrInput.classList.remove('border-red-500');
                return false;
            }
        }

        async function printAllQRCodes() {
            // Get all exhibits with QR codes
            const exhibitsWithQR = allExhibits.filter(e => e.qr);

            if (exhibitsWithQR.length === 0) {
                await customAlert('QR kodu atanmƒ±≈ü eser bulunamadƒ±!', 'error');
                return;
            }

            // Create print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>T√ºm QR Kodlarƒ± Yazdƒ±r</title>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"><\/script>
                    <style>
                        @page { size: A4; margin: 10mm; }
                        * { box-sizing: border-box; margin: 0; padding: 0; }
                        body { font-family: Arial, sans-serif; }
                        .qr-grid { 
                            display: grid; 
                            grid-template-columns: repeat(3, 1fr); 
                            gap: 15px; 
                            padding: 10px;
                        }
                        .qr-item { 
                            border: 2px solid #333; 
                            border-radius: 8px; 
                            padding: 15px; 
                            text-align: center;
                            page-break-inside: avoid;
                        }
                        .qr-code { 
                            display: flex; 
                            justify-content: center; 
                            margin-bottom: 10px; 
                        }
                        .qr-title { 
                            font-size: 11px; 
                            font-weight: bold; 
                            line-height: 1.3;
                            min-height: 35px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                        .qr-id { 
                            font-size: 10px; 
                            color: #666; 
                            margin-top: 5px; 
                        }
                        h1 { 
                            text-align: center; 
                            margin-bottom: 20px; 
                            font-size: 18px;
                        }
                        @media print {
                            .qr-item { break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <h1>QR Kodlar</h1>
                    <div class="qr-grid" id="qr-container"></div>
                    <script>
                        const exhibits = ${JSON.stringify(exhibitsWithQR.map(e => ({ qr: e.qr, title: e.title })))};
                        const container = document.getElementById('qr-container');
                        
                        exhibits.forEach(e => {
                            const item = document.createElement('div');
                            item.className = 'qr-item';
                            item.innerHTML = \`
                                <div class="qr-code" id="qr-\${e.qr}"></div>
                                <div class="qr-title">\${e.title}</div>
                                <div class="qr-id">\${e.qr}</div>
                            \`;
                            container.appendChild(item);
                            
                            new QRCode(document.getElementById('qr-' + e.qr), {
                                text: e.qr,
                                width: 120,
                                height: 120,
                                colorDark: "#000000",
                                colorLight: "#ffffff",
                                correctLevel: QRCode.CorrectLevel.H
                            });
                        });
                        
                        // Auto print after QR codes are generated
                        setTimeout(() => {
                            window.print();
                        }, 1000);
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        let currentQRInstance = null;

        function showQRCode(qrId, exhibitTitle = '') {
            // Find exhibit title if not provided
            if (!exhibitTitle) {
                const exhibit = allExhibits.find(e => e.qr === qrId);
                exhibitTitle = exhibit ? exhibit.title : '';
            }

            document.getElementById('qr-modal-title').textContent = exhibitTitle;
            document.getElementById('qr-modal-id').textContent = qrId;

            // Clear previous QR code
            const container = document.getElementById('qr-code-container');
            container.innerHTML = '';

            // Generate new QR code
            currentQRInstance = new QRCode(container, {
                text: qrId,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            document.getElementById('qr-modal').classList.remove('hidden');
            document.getElementById('qr-modal').classList.add('flex');
        }

        function closeQRModal() {
            document.getElementById('qr-modal').classList.add('hidden');
            document.getElementById('qr-modal').classList.remove('flex');
        }

        function downloadQRCode() {
            const container = document.getElementById('qr-code-container');
            const canvas = container.querySelector('canvas');
            const qrId = document.getElementById('qr-modal-id').textContent;
            const title = document.getElementById('qr-modal-title').textContent;

            if (canvas) {
                // Create styled canvas with border and title
                const padding = 20;
                const borderWidth = 3;
                const titleHeight = 50;
                const idHeight = 25;
                const totalWidth = canvas.width + (padding * 2) + (borderWidth * 2);
                const totalHeight = canvas.height + titleHeight + idHeight + (padding * 2) + (borderWidth * 2);

                const styledCanvas = document.createElement('canvas');
                styledCanvas.width = totalWidth;
                styledCanvas.height = totalHeight;
                const ctx = styledCanvas.getContext('2d');

                // White background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, totalWidth, totalHeight);

                // Border
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = borderWidth;
                ctx.roundRect(borderWidth / 2, borderWidth / 2, totalWidth - borderWidth, totalHeight - borderWidth, 10);
                ctx.stroke();

                // QR Code
                const qrX = (totalWidth - canvas.width) / 2;
                const qrY = padding + borderWidth;
                ctx.drawImage(canvas, qrX, qrY);

                // Title
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                const titleY = qrY + canvas.height + 25;

                // Word wrap title if too long
                const maxWidth = totalWidth - 20;
                const words = title.split(' ');
                let line = '';
                let lineY = titleY;

                for (let word of words) {
                    const testLine = line + word + ' ';
                    const metrics = ctx.measureText(testLine);
                    if (metrics.width > maxWidth && line !== '') {
                        ctx.fillText(line.trim(), totalWidth / 2, lineY);
                        line = word + ' ';
                        lineY += 16;
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line.trim(), totalWidth / 2, lineY);

                // QR ID
                ctx.fillStyle = '#666666';
                ctx.font = '12px Arial';
                ctx.fillText(qrId, totalWidth / 2, totalHeight - padding);

                // Download
                const link = document.createElement('a');
                link.download = `${qrId}.png`;
                link.href = styledCanvas.toDataURL('image/png');
                link.click();
            }
        }

        // Load categories for dropdown
        let exhibitCategories = [];

        async function loadCategories() {
            try {
                const data = await fetchWithAuth(`${API_BASE}/exhibit-categories`);
                if (data && data.categories) {
                    exhibitCategories = data.categories;
                    const select = document.getElementById('modal-category');
                    select.innerHTML = '<option value="">Se√ßiniz...</option>';
                    exhibitCategories.forEach(cat => {
                        select.innerHTML += `<option value="${cat}">${cat}</option>`;
                    });
                }
            } catch (e) {
                console.error('Failed to load categories:', e);
            }
        }

        // Load categories on page load if logged in
        if (authToken) {
            loadCategories();
        }

        // ========== IMAGE UPLOAD HANDLERS ==========
        let pendingImageBase64 = null;

        function setupImageDropZone() {
            const dropZone = document.getElementById('image-drop-zone');
            const fileInput = document.getElementById('image-file-input');
            const preview = document.getElementById('image-preview');
            const placeholder = document.getElementById('image-placeholder');

            if (!dropZone) return;

            // Click to select file
            dropZone.addEventListener('click', () => fileInput.click());

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    handleImageFile(e.target.files[0]);
                }
            });

            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-blue-500');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('border-blue-500');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-500');
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleImageFile(e.dataTransfer.files[0]);
                }
            });

            // Paste (Ctrl+V) - listen on window
            window.addEventListener('paste', (e) => {
                const modal = document.getElementById('exhibit-modal');
                if (!modal || !modal.classList.contains('flex')) return; // Only when modal is open

                const items = e.clipboardData?.items || e.clipboardData?.files;
                if (!items) return;

                for (let i = 0; i < items.length; i++) {
                    const item = items[i];
                    if (item.type && item.type.startsWith('image/')) {
                        e.preventDefault();
                        const file = item.getAsFile ? item.getAsFile() : item;
                        if (file) {
                            handleImageFile(file);
                            console.log('Image pasted:', file.name || 'clipboard image');
                        }
                        break;
                    }
                }
            });
        }

        function handleImageFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                pendingImageBase64 = e.target.result;
                showImagePreview(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        function showImagePreview(src) {
            const preview = document.getElementById('image-preview');
            const placeholder = document.getElementById('image-placeholder');
            preview.src = src;
            preview.classList.remove('hidden');
            placeholder.classList.add('hidden');
        }

        // Track if existing image should be deleted
        let deleteExistingImage = false;

        async function clearImagePreview() {
            const preview = document.getElementById('image-preview');
            const placeholder = document.getElementById('image-placeholder');
            const currentImageUrl = document.getElementById('modal-image').value;

            // If there's an existing image URL (not base64), mark for deletion
            if (currentImageUrl && currentImageUrl.startsWith('/static/')) {
                deleteExistingImage = true;
            }

            preview.src = '';
            preview.classList.add('hidden');
            placeholder.classList.remove('hidden');
            document.getElementById('modal-image').value = '';
            pendingImageBase64 = null;
        }

        async function deleteImageFromServer(exhibitId) {
            if (!exhibitId) return;
            try {
                await fetch(`${API_BASE}/delete-image/${exhibitId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
            } catch (e) {
                console.error('Image delete failed:', e);
            }
        }

        async function uploadPendingImage(exhibitId) {
            if (!pendingImageBase64) return null;

            // Convert ID_33 to FOTO_33 format
            const num = exhibitId.replace('ID_', '');
            const fotoName = `FOTO_${num}`;

            try {
                const res = await fetch(`${API_BASE}/upload-image`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        image_data: pendingImageBase64,
                        filename: fotoName
                    })
                });

                if (res.ok) {
                    const data = await res.json();
                    return data.url;
                }
            } catch (e) {
                console.error('Image upload failed:', e);
            }
            return null;
        }

        // Setup on page load
        setTimeout(setupImageDropZone, 500);


        async function showCreateExhibitModal() {
            isCreatingNew = true;
            currentEditExhibitId = null;
            document.getElementById('modal-title').textContent = 'Yeni Eser Olu≈ütur';
            // Show next available ID (auto-assigned, read-only)
            document.getElementById('modal-exhibit-id').value = window.nextExhibitId || 'ID_01';
            document.getElementById('modal-exhibit-id').disabled = true;
            document.getElementById('modal-qr-id').value = '';
            document.getElementById('modal-title-input').value = '';
            document.getElementById('modal-category').value = '';
            document.getElementById('modal-content').value = '';
            deleteExistingImage = false;  // Reset flag
            clearImagePreview();
            await loadCategories();
            // Hide delete button for new exhibits
            document.getElementById('modal-delete-btn').classList.add('hidden');

            // Reset button and input states
            document.getElementById('modal-save-btn').disabled = false;
            document.getElementById('modal-save-btn').innerHTML = 'Kaydet';
            document.getElementById('modal-cancel-btn').disabled = false;
            document.getElementById('modal-qr-oto-btn').disabled = false;

            // Re-enable all form inputs except ID
            const formInputs = document.querySelectorAll('#exhibit-modal input, #exhibit-modal textarea, #exhibit-modal select');
            formInputs.forEach(input => input.disabled = false);
            document.getElementById('modal-exhibit-id').disabled = true;  // ID always disabled

            document.getElementById('exhibit-modal').classList.remove('hidden');
            document.getElementById('exhibit-modal').classList.add('flex');
        }

        async function openExhibitEditor(exhibitId) {
            isCreatingNew = false;
            currentEditExhibitId = exhibitId;
            deleteExistingImage = false;  // Reset flag

            const data = await fetchWithAuth(`${API_BASE}/rag-exhibits/${exhibitId}`);
            if (!data) return;

            // Extract title from first line
            const content = data.content || '';
            const lines = content.split('\n');
            const title = lines[0] || '';
            const restContent = lines.slice(1).join('\n').trimStart();

            document.getElementById('modal-title').textContent = 'Eser D√ºzenle';
            document.getElementById('modal-exhibit-id').value = data.exhibit_id;
            document.getElementById('modal-exhibit-id').disabled = true;
            document.getElementById('modal-qr-id').value = data.qr || '';
            document.getElementById('modal-title-input').value = title;
            document.getElementById('modal-content').value = restContent;

            // Load categories
            await loadCategories();
            document.getElementById('modal-category').value = data.category || '';

            // Reset image preview
            clearImagePreview();
            pendingImageBase64 = null;
            deleteExistingImage = false;  // Reset here too

            // Show existing image if available (directly from API response)
            if (data.image) {
                document.getElementById('modal-image').value = data.image;
                showImagePreview(data.image);
            }

            // Show delete button for existing exhibits
            document.getElementById('modal-delete-btn').classList.remove('hidden');

            // Reset button states (in case they were disabled from previous operation)
            document.getElementById('modal-save-btn').disabled = false;
            document.getElementById('modal-save-btn').innerHTML = 'Kaydet';
            document.getElementById('modal-cancel-btn').disabled = false;
            document.getElementById('modal-delete-btn').disabled = false;
            document.getElementById('modal-qr-oto-btn').disabled = false;

            // Re-enable all form inputs except ID
            const formInputs = document.querySelectorAll('#exhibit-modal input, #exhibit-modal textarea, #exhibit-modal select');
            formInputs.forEach(input => input.disabled = false);
            document.getElementById('modal-exhibit-id').disabled = true;  // ID always disabled

            document.getElementById('exhibit-modal').classList.remove('hidden');
            document.getElementById('exhibit-modal').classList.add('flex');
        }

        async function deleteFromModal() {
            if (!currentEditExhibitId) return;

            const exhibitIdToDelete = currentEditExhibitId;  // Save before modal closes
            const titleToDelete = document.getElementById('modal-title-input').value;
            const confirmed = await customConfirm(`"${titleToDelete}" eserini silmek istediƒüinize emin misiniz?`);
            if (!confirmed) return;

            closeExhibitModal();

            // Direct delete without calling deleteRAGExhibit (which has its own confirm)
            const res = await fetch(`${API_BASE}/rag-exhibits/${exhibitIdToDelete}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${authToken}` }
            });

            if (res.ok) {
                await customAlert('Eser silindi! RAG g√ºncellemesi gerekli.', 'success');
                await loadExhibits();
            } else {
                await customAlert('Silme hatasƒ±!', 'error');
            }
        }

        function closeExhibitModal() {
            document.getElementById('exhibit-modal').classList.add('hidden');
            document.getElementById('exhibit-modal').classList.remove('flex');
            currentEditExhibitId = null;
            isCreatingNew = false;
        }

        async function saveExhibitModal() {
            const exhibitId = document.getElementById('modal-exhibit-id').value.trim();
            const qr = document.getElementById('modal-qr-id').value.trim();
            const titleInput = document.getElementById('modal-title-input').value.trim();
            const category = document.getElementById('modal-category').value;
            const image = document.getElementById('modal-image').value.trim();
            const contentBody = document.getElementById('modal-content').value;

            // Combine title and content
            const fullContent = titleInput ? `${titleInput}\n\n${contentBody}` : contentBody;

            if (!exhibitId && !isCreatingNew) {
                await customAlert('ID gerekli!', 'error');
                return;
            }

            // Check for duplicate QR before saving
            if (qr) {
                const isDuplicate = allExhibits.some(e =>
                    e.qr === qr &&
                    e.exhibit_id !== currentEditExhibitId
                );

                if (isDuplicate) {
                    await customAlert(`"${qr}" QR kodu zaten kullanƒ±lƒ±yor!\\nBa≈üka bir QR kodu girin.`, 'error');
                    document.getElementById('modal-qr-id').focus();
                    return;
                }
            }

            // Show loading and disable form
            const saveBtn = document.getElementById('modal-save-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');
            const deleteBtn = document.getElementById('modal-delete-btn');
            const formInputs = document.querySelectorAll('#exhibit-modal input, #exhibit-modal textarea, #exhibit-modal select');

            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<span class="animate-spin">‚è≥</span> Kaydediliyor...';
            saveBtn.disabled = true;
            cancelBtn.disabled = true;
            deleteBtn.disabled = true;
            formInputs.forEach(input => input.disabled = true);

            let res;
            try {
                if (isCreatingNew) {
                    res = await fetch(`${API_BASE}/rag-exhibits`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ content: fullContent, qr: qr, title: titleInput, category: category })
                    });
                } else {
                    res = await fetch(`${API_BASE}/rag-exhibits/${currentEditExhibitId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({ content: fullContent, qr: qr, title: titleInput, category: category })
                    });
                }

                if (res.ok) {
                    // Get exhibit_id from response (for new exhibit) or use current (for edit)
                    const responseData = await res.clone().json();
                    const exhibitIdToUse = responseData.exhibit_id || currentEditExhibitId;

                    // Delete existing image if marked for deletion
                    if (deleteExistingImage && exhibitIdToUse) {
                        await deleteImageFromServer(exhibitIdToUse);
                    }

                    // Upload pending image if exists
                    let finalImageUrl = document.getElementById('modal-image').value.trim();
                    if (pendingImageBase64 && exhibitIdToUse) {
                        const uploadedUrl = await uploadPendingImage(exhibitIdToUse);
                        if (uploadedUrl) {
                            finalImageUrl = uploadedUrl;
                        }
                    }

                    // Note: Metadata (title, qr, category) is already saved by the API via /rag-exhibits endpoint
                    // Only need to update image if one was uploaded
                    if (finalImageUrl && pendingImageBase64) {
                        // Get the exhibit_id for metadata update
                        const responseData = await res.clone().json();
                        const exhibitIdForMeta = responseData.exhibit_id || currentEditExhibitId;
                        if (exhibitIdForMeta) {
                            await fetch(`${API_BASE}/rag-exhibits/${exhibitIdForMeta}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${authToken}`
                                },
                                body: JSON.stringify({ content: fullContent, qr: qr, title: titleInput, category: category, image: finalImageUrl })
                            });
                        }
                    }

                    // Reset button
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;

                    // Show success popup - user clicks OK to close
                    await customAlert('‚úÖ ESER Y√úKLENDƒ∞!\n\nRAG G√ºncellemesi gerekir.', 'success');

                    closeExhibitModal();
                    exhibitMetadataCache = null;
                    await loadExhibits();
                } else {
                    const err = await res.json();
                    await customAlert('Hata: ' + (err.detail || 'Bilinmeyen hata'), 'error');
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                    cancelBtn.disabled = false;
                    deleteBtn.disabled = false;
                    formInputs.forEach(input => input.disabled = false);
                    // Re-enable the ID field properly (always disabled)
                    document.getElementById('modal-exhibit-id').disabled = true;
                }
            } catch (e) {
                await customAlert('Hata: ' + e.message, 'error');
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                cancelBtn.disabled = false;
                deleteBtn.disabled = false;
                formInputs.forEach(input => input.disabled = false);
                document.getElementById('modal-exhibit-id').disabled = true;
            }
        }

        async function deleteRAGExhibit(exhibitId) {
            const confirmed = await customConfirm(`"${exhibitId}" silinsin mi?\n\nBu i≈ülem geri alƒ±namaz!`);
            if (!confirmed) return;

            const res = await fetch(`${API_BASE}/rag-exhibits/${exhibitId}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${authToken}` }
            });

            if (res.ok) {
                await customAlert('Eser silindi! RAG g√ºncellemesi gerekli.', 'success');
                await loadExhibits();
            } else {
                await customAlert('Silme hatasƒ±!', 'error');
            }
        }

        async function runRAGIngestion() {
            const confirmed = await customConfirm('RAG veritabanƒ± yeniden olu≈üturulacak.\n\nBu i≈ülem birka√ß saniye s√ºrebilir. Devam?', 'RAG G√ºncelleme');
            if (!confirmed) return;

            // Show loading overlay
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');

            const btn = document.getElementById('ingest-btn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin">sync</span> ƒ∞≈üleniyor...';

            try {
                const res = await fetch(`${API_BASE}/rag-ingest`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ clear: true })
                });

                if (res.ok) {
                    const data = await res.json();
                    await customAlert(data.message || 'RAG g√ºncellendi!', 'success');
                } else {
                    const err = await res.json();
                    await customAlert('Hata: ' + (err.detail || 'Bilinmeyen hata'), 'error');
                }
            } catch (e) {
                await customAlert('Baƒülantƒ± hatasƒ±: ' + e.message, 'error');
            } finally {
                // Hide loading overlay
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');

                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // Update showTab to handle exhibits
        const originalShowTab = showTab;
        showTab = function (tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active', 'bg-blue-500');
                b.classList.add('bg-slate-700');
            });

            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('bg-slate-700');

            if (tabName === 'dashboard') loadDashboard();
            if (tabName === 'exhibits') loadExhibits();
            if (tabName === 'tokens') loadTokens();
            if (tabName === 'stats') loadStats();
            if (tabName === 'api') loadApiKeys();
        };
    </script>
</body>

</html>